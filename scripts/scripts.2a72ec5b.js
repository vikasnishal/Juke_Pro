"use strict";var jukeApplication=angular.module("jukeApp",["ngRoute","ui.bootstrap","jukeApp.controllers","jukeApp.servicesV3","jukeApp.filters","jukeApp.directives","LocalStorageModule","firebase"]);jukeApplication.run(function(){var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}),jukeApplication.constant("FIREBASE_URL","https://glaring-fire-3581.firebaseio.com"),jukeApplication.config(["$routeProvider","localStorageServiceProvider",function(a,b){a.when("/jukeApp",{templateUrl:"views/home.html",controller:"VideosController"}),a.when("/contact",{templateUrl:"views/contact.html",controller:"ContactController"}),a.otherwise({redirectTo:"/jukeApp"}),b.setPrefix("jukeApp").setStorageType("localStorage").setNotify(!0,!0)}]);var jukeService=angular.module("jukeApp.servicesV3",[]);jukeService.service("config",["$location",function(a){var b=a.protocol()+"://"+a.host()+(a.port()?":"+a.port():"")+"/"+a.absUrl().split("/")[3];this.prefix=b+"/api/store/api",this.pdfPrefix=b+"/api/store/pdf"}]),jukeService.service("VideosService",["$window","$rootScope","$log","localStorageService","$timeout","$http","$location",function(a,b,c,d,e,f,g){function h(){c.info("YouTube Player is ready")}function i(a){if(a.data==YT.PlayerState.PLAYING)m.state="playing";else if(a.data==YT.PlayerState.PAUSED)m.state="paused";else if(a.data==YT.PlayerState.ENDED)if(m.state="ended",q.repeatOn)j.launchPlayer(m.videoId,m.videoTitle);else{if(1==o.length)return;if(q.shuffleOn){var c=s(0,o.length,0);j.launchPlayer(o[c].id,o[c].title),j.archiveVideo(o[c].id,o[c].title)}else for(var d in o)if(o[d].id==m.videoId)return d++,void j.launchPlayer(o[d].id,o[d].title)}b.$apply()}var j=this,k=(d.getStorageType(),function(a,b){return d.set(a,b)}),l=function(a){return d.get(a)},m={ready:!1,player:null,playerId:null,videoId:null,videoTitle:null,playerHeight:"480",playerWidth:"570",state:"stopped",origin:"http://localhost:9000"},n=[],o=[{id:"kRJuY6ZDLPo",title:"La Roux - In for the Kill (Twelves Remix)"}],p=[{id:"XKa7Ywiv734",title:"[OFFICIAL HD] Daft Punk - Give Life Back To Music (feat. Nile Rodgers)"}],q={shuffleOn:!1,repeatOn:!1};this.isShuffleOn=function(){return q},this.setShuffleOn=function(){0==q.shuffleOn&&o.length>1?q.shuffleOn=!0:q.shuffleOn=!1};var r={id:"",title:""};this.setRepeatOn=function(a,b){0==q.repeatOn?q.repeatOn=!0:q.repeatOn=!1,r.id=a,r.title=b};var s=function(a,b,c){var d=Math.floor(Math.random()*(b-1)+a);return o[d].id==c&&s(a,b,c),d};this.createRandomNumber=function(a,b,c){return s(a,b,c)},a.onYouTubeIframeAPIReady=function(){c.info("Youtube API is ready"),m.ready=!0,j.bindPlayer("placeholder"),j.loadPlayer(),b.$apply()},this.bindPlayer=function(a){c.info("Binding to "+a),m.playerId=a},this.createPlayer=function(){return c.info("Creating a new Youtube player for DOM id "+m.playerId+" and video "+m.videoId),new YT.Player(m.playerId,{height:m.playerHeight,width:m.playerWidth,events:{onReady:h,onStateChange:i}})},this.loadPlayer=function(){console.log("player is loaded"),m.ready&&m.playerId&&(m.player&&m.player.destroy(),m.player=j.createPlayer())},this.launchPlayer=function(a,b){if(m.ready&&m.playerId)return m.player.loadVideoById(a),m.videoId=a,m.videoTitle=b,m;m.ready=!0,j.bindPlayer("placeholder"),j.loadPlayer();e(function(){return m.player.loadVideoById(a),m.videoId=a,m.videoTitle=b,m},2e3)},this.listResults=function(a){n.length=0;for(var b=a.items.length-1;b>=0;b--)n.push({id:a.items[b].id.videoId,title:a.items[b].snippet.title,description:a.items[b].snippet.description,thumbnail:a.items[b].snippet.thumbnails.default.url,author:a.items[b].snippet.channelTitle});return n},this.queueVideo=function(a,b){return o.push({id:a,title:b}),k("playlist",o),console.log(l("playlist")),o},this.archiveVideo=function(a,b){return p.unshift({id:a,title:b}),p},this.deleteVideo=function(a,b,c){for(var d=a.length-1;d>=0;d--)a[d].id===b&&(a.splice(d,1),"new"==c?k("playlist",a):"old"==c&&k("historylist",a),console.log(l("playlist")))},this.getYoutube=function(){return m},this.getResults=function(){return n},this.getUpcoming=function(){return null==l("playlist")?(k("playlist",o),o):o=l("playlist")},this.getHistory=function(){return null==l("historylist")?(k("historylist",p),p):p=l("historylist")},this.searchQuery=function(a){return f.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyDH6OIM74sXrUs4_t-2cmfotq3PVRl_CfM",type:"video",maxResults:"8",order:"viewCount",videoDuration:"medium",part:"id,snippet",fields:"items/id,items/snippet/title,items/snippet/description,items/snippet/thumbnails/default",q:a}})}}]);var jukeCtrl=angular.module("jukeApp.controllers",[]);jukeCtrl.controller("VideosController",["$scope","$http","$log","VideosService","$timeout","localStorageService","$modal","$firebaseAuth",function(a,b,c,d,e,f,g,h){a.loadingBoot={loading:!1},a.launch=function(b,c){a.loadingBoot.loading=!0,d.launchPlayer(b,c),a.loadingBoot.loading=!1,d.archiveVideo(b,c)},a.queue=function(b,c){a.loadingBoot.loading=!0;e(function(){a.loadingBoot.loading=!1,d.queueVideo(b,c),d.deleteVideo(a.history,b),1==a.upcoming.length&&a.launch(b,c)},1e3)},a.delete=function(b,c,f){a.loadingBoot.loading=!0,1==b.length&&(a.youtube={}),a.youtube.videoId==c&&(a.upcoming[a.upcoming.length-1].id==c?a.playPrevious(c):a.playNext(c));e(function(){a.loadingBoot.loading=!1,d.deleteVideo(b,c,f)},1e3)},a.changeShuffle=function(){d.setShuffleOn()},a.changeRepeat=function(a,b){d.setRepeatOn(a,b)},a.playPrevious=function(b){a.loadingBoot.loading=!0;e(function(){if(a.loadingBoot.loading=!1,1==a.shuffleon.shuffleOn){var c=d.createRandomNumber(0,a.upcoming.length,b);d.launchPlayer(a.upcoming[c].id,a.upcoming[c].title)}else{if(a.upcoming[0].id==b)return;for(var e in a.upcoming)if(a.upcoming[e].id==b)return e--,void d.launchPlayer(a.upcoming[e].id,a.upcoming[e].title)}},1e3)},a.playNext=function(b){a.loadingBoot.loading=!0;e(function(){if(a.loadingBoot.loading=!1,1==a.shuffleon.shuffleOn){var c=d.createRandomNumber(0,a.upcoming.length,b);d.launchPlayer(a.upcoming[c].id,a.upcoming[c].title)}else{if(a.upcoming[a.upcoming.length-1].id==b)return;for(var e in a.upcoming)if(a.upcoming[e].id==b)return e++,void d.launchPlayer(a.upcoming[e].id,a.upcoming[e].title)}},1e3)},a.search=function(b){a.loadingBoot.loading=!0,d.searchQuery(b).then(function(b){a.loadingBoot.loading=!1,d.listResults(b.data)},function(){a.loadingBoot.loading=!1,c.info("Search error")})},a.tabulate=function(b){a.playlist=b};!function(){a.youtube=d.getYoutube(),a.results=d.getResults(),a.upcoming=d.getUpcoming(),a.history=d.getHistory(),a.playlist=!0,a.shuffleon=d.isShuffleOn(),a.search("new songs")}();a.login=function(){g.open({templateUrl:"views/loginModal.html",controller:modalInstanceController,windowClass:"app-modal-width"})},a.register=function(){g.open({templateUrl:"views/registerModal.html",controller:modalInstanceController,windowClass:"app-modal-width"})}}]),jukeCtrl.controller("ContactController",["$scope",function(a){}]);var modalInstanceController=["$scope","$modalInstance","$firebaseAuth","localStorageService",function(a,b,c,d){var e=new Firebase("https://glaring-fire-3581.firebaseio.com/"),f=c(e);a.user={email:"",password:""},a.login=function(a){f.$authWithPassword({email:a.email,password:a.password}).then(function(a){console.log("Logged in as:",a),d.set("loginDetails",a),b.close()}).catch(function(a){console.error("Authentication failed:",a),b.dismiss()})},a.register=function(a){a.password==a.confirmPassword&&f.$createUser({email:a.email,password:a.password}).then(function(a){console.log("user created",a)}).catch(function(a){console.error("User Creation failed:",a),b.dismiss()})},a.redirectToCurrentPage=function(){b.close()}}],jukeFilter=angular.module("jukeApp.filters",[]),jukeDirective=angular.module("jukeApp.directives",[]);